(function(){$(function(){var a,b,c;return c=d3.time.format("%d.%m.%Y %X"),a=function(a,b){var c,d,e,f,g,h,i,j,k,l;for(d={},j=a.timeFrames,h=0,i=j.length;i>h;h++){e=j[h],k=e[b];for(f in k)g=k[f],d[f]||(d[f]=[]),d[f].push({x:e.startTime,y:g,startTime:new Date(1e3*e.startTime),endTime:new Date(1e3*e.endTime)})}l=[];for(f in d)c=d[f],l.push({key:f,values:c});return l},b=$.ajax({dataType:"json",url:"http://"+location.hostname+":50201/api/v1/user-report.json"+location.search,beforeSend:function(){return console.debug("["+new Date+"] Loading report.")},error:function(a,b,c){return console.log("Ups",a,b,c,c)},success:function(b){var d,e,f,g,h;return console.debug("["+new Date+"] Got report!"),window.report=b,h=c(new Date(1e3*b.startTime)),g=c(new Date(1e3*b.endTime)),$("#date-container").text(""+h+" - "+g+" (Aufl√∂sung "+b.intervalSize/60+"min)"),$("#nav-mode-"+b.mode).addClass("active"),d=a(b,"powerUsage"),f=nv.models.pieChart().x(function(a){return a.key}).y(function(a){return d3.sum(a.values.map(function(a){return a.y}))}).valueFormat(function(a){return d3.format(".2f")(a)+"KWh"}),d3.select("#power-pie-chart").datum(d).call(f),e=nv.models.multiBarChart().stacked(!0).tooltipContent(function(a,b,c,d){return"<h3>"+a+"</h3><p>"+c+" at "+d3.time.format("%d.%m.%Y %H:%M")(d.point.startTime)+"-"+d3.time.format("%H:%M")(d.point.endTime)+"</p>"}),e.yAxis.tickFormat(function(a){return d3.format(",.2f")(a)+"KWh"}),e.xAxis.tickFormat(function(a){return d3.time.format("%H:%M-")(new Date(1e3*a))+d3.time.format("%H:%M")(new Date(1e3*(a+b.intervalSize-1)))}),d3.select("#power-line-chart").datum(d).transition().duration(500).call(e),$(".loading-banner").hide()}})})}).call(this);